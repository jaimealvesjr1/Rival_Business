{% extends "base.html" %}

{% block content %}
    <h1 class="mt-4">Painel de Gestão</h1>

    <ul class="nav nav-tabs" id="manageTabs" role="tablist">
        <li class="nav-item">
            <a class="nav-link active" id="jogadores-tab" data-toggle="tab" href="#jogadores" role="tab">Jogadores ({{ jogadores|length }})</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" id="regioes-tab" data-toggle="tab" href="#regioes" role="tab">Regiões ({{ regioes|length }})</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" id="empresas-tab" data-toggle="tab" href="#empresas" role="tab">Empresas ({{ empresas|length }})</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" id="tipos-veiculos-tab" data-toggle="tab" href="#tipos-veiculos" role="tab">Modelos de Veículo ({{ tipos_veiculos|length }})</a>
        </li>
    </ul>

    <div class="tab-content" id="manageTabsContent">
      
      <div class="tab-pane fade show active" id="jogadores" role="tabpanel">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h2 class="mb-3 mt-4">Lista de Jogadores</h2>
            <div class="btn-group">
                <a href="{{ url_for('manage.create_player') }}" class="btn btn-primary mb-3">Novo Jogador</a>
            </div>
        </div>
        <div class="table-responsive">
             <table class="table table-striped table-sm">
                <thead><tr><th>ID</th><th>Usuário</th><th>Experiência</th><th>Nível</th><th>Gold</th><th>Dinheiro</th><th>XP Trabalho</th><th>Admin?</th><th>Ações</th></tr></thead>
                <tbody>
                    {% for jogador in jogadores %}
                    <tr>
                        <td>{{ jogador.id }}</td>
                        <td>{{ jogador.username }}</td>
                        <td>{{ jogador.experiencia | currency_format('', separator='.')  }}</td>
                        <td>{{ jogador.nivel }}</td>
                        <td>{{ "%.2f"|format(jogador.gold) }} Kg</td>
                        <td>{{ jogador.dinheiro | currency_format('R$', '.') }}</td>
                        <td>{{ jogador.experiencia_trabalho | currency_format('', separator='.')  }}</td>
                        <td>{{ 'Sim' if jogador.is_admin else 'Não' }}</td>
                        <td>
                            <a href="{{ url_for('manage.edit_player', player_id=jogador.id) }}" class="btn btn-sm btn-info mr-1">Editar</a>
                            <form method="POST" action="{{ url_for('manage.delete_data', model_name='jogador', id=jogador.id) }}" class="d-inline" onsubmit="return confirm('Tem certeza que deseja EXCLUIR o jogador {{ jogador.username }}?');">
                                <button type="submit" class="btn btn-sm btn-danger">Excluir</button>
                            </form>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
      </div>

      <div class="tab-pane fade" id="regioes" role="tabpanel">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h2 class="mb-3 mt-4">Lista de Regiões</h2>
            <div class="btn-group">
                <a href="{{ url_for('manage.create_region') }}" class="btn btn-primary mb-3">Nova Localização</a>
            </div>
        </div>

        <div class="table-responsive">
            <table class="table table-striped table-sm">
                <thead><tr><th>ID</th><th>Nome</th><th>Latitude/Longitude</th><th>Índices(Dev - Saúde - Edu)</th><th>Tributação</th><th>Reserva Ouro</th><th>Ações</th></tr></thead>
                <tbody>
                    {% for regiao in regioes %}
                    <tr>
                        <td>{{ regiao.id }}</td>
                        <td>{{ regiao.nome }}</td>
                        <td>({{ "%.2f"|format(regiao.latitude) }}, {{ "%.2f"|format(regiao.longitude) }})</td>
                        <td>{{ "%.1f"|format(regiao.indice_desenvolvimento) }} / 10 - {{ "%.1f"|format(regiao.indice_saude) }} / 10 - {{ "%.1f"|format(regiao.indice_educacao) }} / 10</td>
                        <td>{{ (regiao.taxa_imposto_geral * 100)|round(0) }}%</td>
                        <td>{{ "%.0f"|format(regiao.reserva_ouro) }}</td>
                        <td>
                            <a href="{{ url_for('manage.edit_region', region_id=regiao.id) }}" class="btn btn-sm btn-info mr-1">Editar</a>
                            <form method="POST" action="{{ url_for('manage.delete_data', model_name='regiao', id=regiao.id) }}" class="d-inline" onsubmit="return confirm('Tem certeza que deseja EXCLUIR a localização {{ regiao.nome }}?');">
                                <button type="submit" class="btn btn-sm btn-danger">Excluir</button>
                            </form>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
      </div>
      
      <div class="tab-pane fade" id="empresas" role="tabpanel">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h2 class="mb-3 mt-4">Lista de Empresas</h2>
            <div class="btn-group">
                <a href="{{ url_for('manage.create_company') }}" class="btn btn-primary mb-3">Nova Empresa</a>
            </div>
        </div>
        <div class="table-responsive">
            <table class="table table-striped table-sm">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Nome</th>
                        <th>Tipo</th>
                        <th>Localização</th>
                        <th>Proprietário</th>
                        <th>Lucro %</th>
                        <th>Ações</th>
                    </tr>
                </thead>
                <tbody>
                    {% for empresa in empresas %}
                    <tr>
                        <td>{{ empresa.id }}</td>
                        <td>{{ empresa.nome }}</td>
                        <td>{{ empresa.tipo | capitalize }}</td>
                        <td>{{ empresa.regiao.nome }}</td>
                        <td>{% if empresa.proprietario %}{{ empresa.proprietario.username }}{% else %}Governo{% endif %}</td>
                        <td>{{ (empresa.taxa_lucro * 100)|round(1) }}%</td>
                        <td>
                            <a href="{{ url_for('manage.edit_company', company_id=empresa.id) }}" class="btn btn-sm btn-info mr-1">Editar</a>
                            <form method="POST" action="{{ url_for('manage.delete_data', model_name='empresa', id=empresa.id) }}" class="d-inline" onsubmit="return confirm('Tem certeza que deseja EXCLUIR a empresa {{ empresa.nome }}?');">
                                <button type="submit" class="btn btn-sm btn-danger">Excluir</button>
                            </form>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
      </div>

    <div class="tab-pane fade" id="tipos-veiculos" role="tabpanel">
        <h2 class="mt-4">Modelos de Veículo</h2>
        <div class="table-responsive">
            <table class="table table-striped table-sm">
                <thead>
                    <tr>
                        <th>Tipo</th>
                        <th>Capacidade (t)</th>
                        <th>Velocidade (%)</th>
                        <th>Validade (d)</th>
                        <th>Custo Frete (R$/t-km)</th>
                        <th>Nv. Esp. Req.</th>
                        <th>Custo (R$/G/Fe)</th>
                    </tr>
                </thead>
                <tbody>
                    {% for tipo in tipos_veiculos %}
                    <tr>
                        <td>{{ tipo.nome_display }}</td>
                        <td>{{ tipo.capacidade | int }}</td>
                        <td>{{ (tipo.velocidade * 100) | int }}</td>
                        <td>{{ tipo.validade_dias }}</td>
                        <td>{{ "%.0f"|format(tipo.custo_tonelada_km) }}</td>
                        <td>{{ tipo.nivel_especializacao_req }}</td>
                        <td>{{ tipo.custo_money | currency_format('R$', '.') }} / Ouro: {{ "%.0f"|format(tipo.custo_gold) }} Kg / Ferro: {{ tipo.custo_ferro | currency_format('', separator='.')  }} ton</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>      
</div>
{% endblock %}